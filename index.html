<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gama Leões de Judá Flag Football</title>
    <style>
        /* Reset e Variáveis */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --primary: #2d5016;
            --secondary: #4a7c2e;
            --accent: #6ba644;
            --danger: #dc3545;
            --warning: #ffc107;
            --dark: #000000;
            --gray: #6c757d;
            --light: #f8f9fa;
            --white: #ffffff;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --radius: 12px;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--light);
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* Layout Principal */
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            background: var(--dark);
            color: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: bold;
            font-size: 1.25rem;
            color: var(--white);
        }
        
        .header-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Navigation */
        .nav {
            background: var(--primary);
            position: sticky;
            top: 60px;
            z-index: 90;
        }
        
        .nav-items {
            display: flex;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        
        .nav-items::-webkit-scrollbar {
            display: none;
        }
        
        .nav-item {
            flex: 0 0 auto;
            padding: 1rem 1.5rem;
            border-bottom: 3px solid transparent;
            color: var(--white);
            text-decoration: none;
            transition: all 0.2s;
            white-space: nowrap;
            cursor: pointer;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
            font-size: 1rem;
            opacity: 0.8;
        }
        
        .nav-item:hover {
            opacity: 1;
        }
        
        .nav-item.active {
            border-bottom-color: var(--accent);
            opacity: 1;
        }
        
        /* Content */
        .content {
            flex: 1;
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* Cards */
        .card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }
        
        .btn-primary:hover {
            background: var(--secondary);
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: var(--white);
        }
        
        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }
        
        .btn-warning {
            background: var(--warning);
            color: var(--dark);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: var(--white);
        }
        
        .btn-icon {
            padding: 0.75rem;
            border-radius: 50%;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }
        
        .form-input,
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--white);
            border-radius: var(--radius);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        /* Lists */
        .player-list {
            list-style: none;
        }
        
        .player-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .player-item:hover {
            background: var(--light);
        }
        
        .player-item.selected {
            background: rgba(75, 124, 46, 0.1);
            border-left: 3px solid var(--secondary);
        }
        
        .player-item.priority {
            background: rgba(255, 193, 7, 0.1);
        }
        
        .player-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.25rem;
            margin-right: 1rem;
        }
        
        .player-info {
            flex: 1;
        }
        
        .player-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .player-details {
            font-size: 0.875rem;
            color: var(--gray);
        }
        
        .player-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .stat-card {
            background: var(--light);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        /* Game Mode */
        .game-mode {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--white);
            z-index: 2000;
            display: flex;
            flex-direction: column;
        }
        
        .game-header {
            background: var(--dark);
            color: var(--white);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .game-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .game-footer {
            padding: 1rem;
            background: var(--white);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .play-type-btn {
            display: flex;
            align-items: center;
            gap: 1rem;
            width: 100%;
            padding: 1.5rem;
            margin-bottom: 1rem;
            background: var(--white);
            border: 2px solid #e5e7eb;
            border-radius: var(--radius);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .play-type-btn:active {
            transform: scale(0.98);
            background: var(--light);
        }
        
        .play-type-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .section-divider {
            margin: 1rem 0;
            padding: 0.5rem;
            background: var(--light);
            border-radius: 8px;
            text-align: center;
            font-size: 0.875rem;
            color: var(--gray);
            font-weight: 600;
        }
        
        /* Export/Import Section */
        .export-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #e5e7eb;
        }
        
        .export-options {
            display: grid;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        /* Training Date Edit */
        .training-date {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gray);
            font-size: 0.875rem;
        }
        
        .date-edit-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        /* Utility Classes */
        .text-center { text-align: center; }
        .text-small { font-size: 0.875rem; }
        .text-gray { color: var(--gray); }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--gray);
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .logo {
                font-size: 1rem;
            }
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 3000;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        /* Position Badges */
        .position-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .position-qb { background: #e3f2fd; color: #1565c0; }
        .position-recebedor { background: #fff3e0; color: #e65100; }
        .position-def { background: #f3e5f5; color: #6a1b9a; }
        
        /* Option Buttons */
        .option-btn {
            display: block;
            width: 100%;
            padding: 1rem;
            margin-bottom: 0.5rem;
            background: var(--white);
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .option-btn:hover {
            border-color: var(--primary);
            background: var(--light);
        }
        
        .option-btn.primary {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }
        
        .option-btn.secondary {
            background: var(--secondary);
            color: var(--white);
            border-color: var(--secondary);
        }
        
        .option-btn.warning {
            background: var(--warning);
            color: var(--dark);
            border-color: var(--warning);
        }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    Gama Leões de Judá Flag Football
                </div>
                <div class="header-actions">
                    <button class="btn btn-icon btn-primary" onclick="app.showExportModal()">
                        💾
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Navigation -->
        <nav class="nav">
            <div class="nav-items">
                <button class="nav-item active" onclick="app.navigate('dashboard')">
                    Dashboard
                </button>
                <button class="nav-item" onclick="app.navigate('players')">
                    Jogadores
                </button>
                <button class="nav-item" onclick="app.navigate('training')">
                    Treinos
                </button>
                <button class="nav-item" onclick="app.navigate('stats')">
                    Estatísticas
                </button>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="content" id="content">
            <!-- Content will be rendered here -->
        </main>
        
        <!-- Modals -->
        <div id="playerModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="playerModalTitle">Adicionar Jogador</h2>
                    <button class="btn btn-icon" onclick="app.closePlayerModal()">✕</button>
                </div>
                <form onsubmit="app.savePlayer(event)">
                    <div class="modal-body">
                        <input type="hidden" id="playerId">
                        <div class="form-group">
                            <label class="form-label">Nome</label>
                            <input type="text" class="form-input" id="playerName" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Número</label>
                                <input type="number" class="form-input" id="playerNumber" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Posição</label>
                                <select class="form-select" id="playerPosition" required>
                                    <option value="QB">Quarterback (QB)</option>
                                    <option value="RECEBEDOR">Recebedor</option>
                                    <option value="DEF">Defensor (DEF)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline" onclick="app.closePlayerModal()">
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Export Modal -->
        <div id="exportModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Exportar/Importar Dados</h2>
                    <button class="btn btn-icon" onclick="app.closeExportModal()">✕</button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <h3 class="mb-2">📤 Exportar Dados</h3>
                        <div class="export-options">
                            <button class="btn btn-primary" onclick="app.exportJSON()">
                                💾 Baixar arquivo JSON completo
                            </button>
                            <button class="btn btn-secondary" onclick="app.copyToClipboard()">
                                📋 Copiar código
                            </button>
                        </div>
                    </div>
                    
                    <div class="export-section">
                        <h3 class="mb-2">📥 Importar Dados</h3>
                        <div class="form-group">
                            <label class="form-label">Arquivo JSON</label>
                            <input type="file" class="form-input" id="importFile" accept=".json" onchange="app.importJSON(event)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ou cole o código aqui</label>
                            <textarea class="form-input" id="importCode" rows="4" placeholder="Cole o código exportado aqui..."></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="app.importFromCode()">
                            Importar do código
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Toast for notifications -->
        <div id="toast" class="toast"></div>
    </div>
    
    <script>
        // Main App Object
        const app = {
            // Data
            data: {
                players: [
                    { id: '1', name: 'Chuck', number: '22', position: 'RECEBEDOR' },
                    { id: '2', name: 'Caio', number: '10', position: 'QB' },
                    { id: '3', name: 'Rai', number: '13', position: 'RECEBEDOR' },
                    { id: '4', name: 'Victor', number: '87', position: 'DEF' },
                    { id: '5', name: 'Lino', number: '9', position: 'QB' },
                    { id: '6', name: 'Rangel', number: '32', position: 'DEF' },
                    { id: '7', name: 'Santos', number: '84', position: 'RECEBEDOR' },
                    { id: '8', name: 'Mateus', number: '15', position: 'DEF' },
                    { id: '9', name: 'Peron', number: '88', position: 'RECEBEDOR' },
                    { id: '10', name: 'Euler', number: '31', position: 'DEF' },
                    { id: '11', name: 'Macaco', number: '26', position: 'RECEBEDOR' },
                    { id: '12', name: 'JP', number: '30', position: 'RECEBEDOR' },
                    { id: '13', name: 'Lomeu', number: '1', position: 'RECEBEDOR' },
                    { id: '14', name: 'Rimack', number: '5', position: 'RECEBEDOR' },
                    { id: '15', name: 'Dauzin', number: '2', position: 'RECEBEDOR' },
                    { id: '16', name: 'Kevin', number: '33', position: 'RECEBEDOR' },
                    { id: '17', name: 'Zille', number: '7', position: 'DEF' },
                    { id: '18', name: 'Rickson', number: '17', position: 'RECEBEDOR' },
                    { id: '19', name: 'Roger', number: '8', position: 'DEF' },
                    { id: '20', name: 'PP', number: '99', position: 'RECEBEDOR' },
                    { id: '21', name: 'Dadau', number: '3', position: 'RECEBEDOR' },
                    { id: '22', name: 'André', number: '77', position: 'DEF' }
                ],
                trainings: [],
                currentPage: 'dashboard',
                currentTraining: null,
                gameMode: {
                    active: false,
                    step: 'initial',
                    playType: null,
                    playData: {},
                    history: []
                }
            },
            
            // Initialize
            init() {
                this.loadData();
                this.render();
                this.attachEventListeners();
            },
            
            // Load data from localStorage
            loadData() {
                const saved = localStorage.getItem('gamaFlagFootballData');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        // Manter jogadores pré-definidos mas adicionar novos se existirem
                        if (parsed.players && parsed.players.length > 0) {
                            // Verificar se são os jogadores padrão ou customizados
                            const hasCustomPlayers = parsed.players.some(p => parseInt(p.id) > 22);
                            if (hasCustomPlayers) {
                                this.data.players = [...this.data.players, ...parsed.players.filter(p => parseInt(p.id) > 22)];
                            }
                        }
                        if (parsed.trainings) {
                            this.data.trainings = parsed.trainings;
                        }
                    } catch (e) {
                        console.error('Error loading data:', e);
                    }
                }
            },
            
            // Save data to localStorage
            saveData() {
                localStorage.setItem('gamaFlagFootballData', JSON.stringify({
                    players: this.data.players,
                    trainings: this.data.trainings
                }));
                this.showToast('✅ Dados salvos!');
            },
            
            // Navigation
            navigate(page) {
                this.data.currentPage = page;
                this.updateNavigation();
                this.render();
            },
            
            updateNavigation() {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`.nav-item:nth-child(${this.getPageIndex() + 1})`).classList.add('active');
            },
            
            getPageIndex() {
                const pages = ['dashboard', 'players', 'training', 'stats'];
                return pages.indexOf(this.data.currentPage);
            },
            
            // Render main content
            render() {
                const content = document.getElementById('content');
                
                switch (this.data.currentPage) {
                    case 'dashboard':
                        content.innerHTML = this.renderDashboard();
                        break;
                    case 'players':
                        content.innerHTML = this.renderPlayers();
                        break;
                    case 'training':
                        content.innerHTML = this.renderTraining();
                        break;
                    case 'stats':
                        content.innerHTML = this.renderStats();
                        break;
                }
            },
            
            // Dashboard
            renderDashboard() {
                const playerCount = this.data.players.length;
                const trainingCount = this.data.trainings.length;
                const lastTraining = this.data.trainings[this.data.trainings.length - 1];
                
                return `
                    <div class="card">
                        <h1 class="card-title mb-3">Dashboard</h1>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Jogadores</div>
                                <div class="stat-value">${playerCount}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Treinos</div>
                                <div class="stat-value">${trainingCount}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Último Treino</div>
                                <div class="stat-value text-small">${lastTraining ? new Date(lastTraining.date).toLocaleDateString('pt-BR') : '-'}</div>
                            </div>
                        </div>
                    </div>
                    
                    ${trainingCount > 0 ? `
                        <div class="card">
                            <h2 class="card-title">Ações Rápidas</h2>
                            <div class="mt-2">
                                <button class="btn btn-primary" onclick="app.startGameMode()">
                                    🎮 Iniciar Modo Jogo
                                </button>
                            </div>
                        </div>
                    ` : `
                        <div class="card">
                            <div class="empty-state">
                                <div class="empty-icon">📋</div>
                                <p>Comece criando seu primeiro treino!</p>
                                <button class="btn btn-primary mt-2" onclick="app.navigate('training')">
                                    Criar Treino
                                </button>
                            </div>
                        </div>
                    `}
                `;
            },
            
            // Players
            renderPlayers() {
                const players = this.data.players;
                
                return `
                    <div class="card">
                        <div class="card-header">
                            <h1 class="card-title">Jogadores</h1>
                            <button class="btn btn-primary btn-small" onclick="app.openPlayerModal()">
                                + Adicionar
                            </button>
                        </div>
                        
                        <ul class="player-list">
                            ${players.map(player => `
                                <li class="player-item">
                                    <div class="player-avatar">${player.name.charAt(0).toUpperCase()}</div>
                                    <div class="player-info">
                                        <div class="player-name">${player.name}</div>
                                        <div class="player-details">
                                            <span class="position-badge position-${player.position.toLowerCase()}">${player.position}</span>
                                            #${player.number}
                                        </div>
                                    </div>
                                    <div class="player-actions">
                                        <button class="btn btn-icon btn-small btn-warning" onclick="app.editPlayer('${player.id}')">
                                            ✏️
                                        </button>
                                        <button class="btn btn-icon btn-small btn-danger" onclick="app.deletePlayer('${player.id}')">
                                            🗑️
                                        </button>
                                    </div>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            },
            
            // Training
            renderTraining() {
                const trainings = this.data.trainings;
                
                return `
                    <div class="card">
                        <div class="card-header">
                            <h1 class="card-title">Treinos</h1>
                            <button class="btn btn-primary btn-small" onclick="app.createTraining()">
                                + Novo Treino
                            </button>
                        </div>
                        
                        ${trainings.length > 0 ? `
                            <div class="mb-3">
                                ${trainings.map((training, index) => `
                                    <div class="card mb-2">
                                        <h3>${training.name}</h3>
                                        <div class="training-date">
                                            <span>${new Date(training.date).toLocaleDateString('pt-BR')}</span>
                                            <button class="date-edit-btn" onclick="app.editTrainingDate(${index})">
                                                ✏️ editar data
                                            </button>
                                        </div>
                                        <p class="text-small">Jogadas registradas: ${training.plays ? training.plays.length : 0}</p>
                                        <div class="mt-2">
                                            <button class="btn btn-primary btn-small" onclick="app.startGameMode(${index})">
                                                🎮 Modo Jogo
                                            </button>
                                            <button class="btn btn-secondary btn-small" onclick="app.exportTrainingJSON(${index})">
                                                💾 Exportar JSON
                                            </button>
                                            <button class="btn btn-danger btn-small" onclick="app.deleteTraining(${index})">
                                                🗑️ Excluir
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="empty-state">
                                <div class="empty-icon">📋</div>
                                <p>Nenhum treino registrado</p>
                                <button class="btn btn-primary mt-2" onclick="app.createTraining()">
                                    Criar Primeiro Treino
                                </button>
                            </div>
                        `}
                    </div>
                `;
            },
            
            // Stats
            renderStats() {
                return `
                    <div class="card">
                        <div class="card-header">
                            <h1 class="card-title">Estatísticas dos Jogadores</h1>
                            <button class="btn btn-secondary btn-small" onclick="app.exportStatsJSON()">
                                💾 Exportar Estatísticas Gerais
                            </button>
                        </div>
                        ${this.data.players.map(player => {
                            const stats = this.calculatePlayerStats(player.id);
                            return `
                                <div class="card mb-2">
                                    <h3>${player.name} - ${player.position}</h3>
                                    <div class="stats-grid mt-2">
                                        ${this.renderPlayerStatsByPosition(player.position, stats)}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            },
            
            renderPlayerStatsByPosition(position, stats) {
                let html = '';
                
                switch (position) {
                    case 'QB':
                        html = `
                            <div class="stat-card">
                                <div class="stat-label">Passes Completos</div>
                                <div class="stat-value">${stats.completions || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Tentativas</div>
                                <div class="stat-value">${stats.attempts || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">% Acerto</div>
                                <div class="stat-value">${stats.attempts > 0 ? Math.round((stats.completions / stats.attempts) * 100) : 0}%</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Jardas</div>
                                <div class="stat-value">${stats.passingYards || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">TDs</div>
                                <div class="stat-value">${stats.touchdowns || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">INTs</div>
                                <div class="stat-value">${stats.interceptions || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Flag Pulls</div>
                                <div class="stat-value">${stats.flagPulls || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Conv 1pt</div>
                                <div class="stat-value">${stats.conv1pt || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Conv 2pt</div>
                                <div class="stat-value">${stats.conv2pt || 0}</div>
                            </div>
                        `;
                        break;
                    case 'RECEBEDOR':
                        html = `
                            <div class="stat-card">
                                <div class="stat-label">Recepções</div>
                                <div class="stat-value">${stats.receptions || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Jardas</div>
                                <div class="stat-value">${stats.receivingYards || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">TDs</div>
                                <div class="stat-value">${stats.touchdowns || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Alvos</div>
                                <div class="stat-value">${stats.targets || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Passes Completos</div>
                                <div class="stat-value">${stats.completions || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Passes Lançados</div>
                                <div class="stat-value">${stats.attempts || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Flag Pulls</div>
                                <div class="stat-value">${stats.flagPulls || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Conv 1pt</div>
                                <div class="stat-value">${stats.conv1pt || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Conv 2pt</div>
                                <div class="stat-value">${stats.conv2pt || 0}</div>
                            </div>
                        `;
                        break;
                    case 'DEF':
                        html = `
                            <div class="stat-card">
                                <div class="stat-label">Flag Pulls</div>
                                <div class="stat-value">${stats.flagPulls || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Sacks</div>
                                <div class="stat-value">${stats.sacks || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">INTs</div>
                                <div class="stat-value">${stats.interceptions || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Passes Defletados</div>
                                <div class="stat-value">${stats.deflections || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">TD Defensivos</div>
                                <div class="stat-value">${stats.touchdowns || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Conv 1pt</div>
                                <div class="stat-value">${stats.conv1pt || 0}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Conv 2pt</div>
                                <div class="stat-value">${stats.conv2pt || 0}</div>
                            </div>
                        `;
                        break;
                }
                
                return html;
            },
            
            calculatePlayerStats(playerId) {
                const stats = {};
                
                this.data.trainings.forEach(training => {
                    if (training.stats && training.stats[playerId]) {
                        Object.entries(training.stats[playerId]).forEach(([key, value]) => {
                            stats[key] = (stats[key] || 0) + value;
                        });
                    }
                });
                
                return stats;
            },
            
            // Player Management
            openPlayerModal() {
                document.getElementById('playerModalTitle').textContent = 'Adicionar Jogador';
                document.getElementById('playerId').value = '';
                document.getElementById('playerName').value = '';
                document.getElementById('playerNumber').value = '';
                document.getElementById('playerPosition').value = 'QB';
                document.getElementById('playerModal').classList.add('active');
            },
            
            editPlayer(id) {
                const player = this.data.players.find(p => p.id === id);
                if (!player) return;
                
                document.getElementById('playerModalTitle').textContent = 'Editar Jogador';
                document.getElementById('playerId').value = player.id;
                document.getElementById('playerName').value = player.name;
                document.getElementById('playerNumber').value = player.number;
                document.getElementById('playerPosition').value = player.position;
                document.getElementById('playerModal').classList.add('active');
            },
            
            closePlayerModal() {
                document.getElementById('playerModal').classList.remove('active');
            },
            
            savePlayer(event) {
                event.preventDefault();
                
                const playerId = document.getElementById('playerId').value;
                const playerData = {
                    name: document.getElementById('playerName').value,
                    number: document.getElementById('playerNumber').value,
                    position: document.getElementById('playerPosition').value
                };
                
                if (playerId) {
                    // Edit existing player
                    const index = this.data.players.findIndex(p => p.id === playerId);
                    this.data.players[index] = { ...this.data.players[index], ...playerData };
                } else {
                    // Add new player
                    const player = {
                        id: Date.now().toString(),
                        ...playerData
                    };
                    this.data.players.push(player);
                }
                
                this.saveData();
                this.closePlayerModal();
                this.render();
            },
            
            deletePlayer(id) {
                if (confirm('Tem certeza que deseja excluir este jogador?')) {
                    this.data.players = this.data.players.filter(p => p.id !== id);
                    this.saveData();
                    this.render();
                }
            },
            
            // Training Management
            createTraining() {
                const training = {
                    id: Date.now().toString(),
                    name: `Treino ${this.data.trainings.length + 1}`,
                    date: new Date().toISOString(),
                    plays: [],
                    stats: {}
                };
                
                this.data.trainings.push(training);
                this.saveData();
                this.render();
            },
            
            editTrainingDate(index) {
                const training = this.data.trainings[index];
                const currentDate = new Date(training.date).toISOString().split('T')[0];
                const newDate = prompt('Nova data (AAAA-MM-DD):', currentDate);
                
                if (newDate) {
                    training.date = new Date(newDate).toISOString();
                    this.saveData();
                    this.render();
                }
            },
            
            deleteTraining(index) {
                if (confirm('Tem certeza que deseja excluir este treino?')) {
                    this.data.trainings.splice(index, 1);
                    this.saveData();
                    this.render();
                }
            },
            
            // Get sorted players with priority position
            getSortedPlayers(priorityPosition = null) {
                const players = [...this.data.players];
                
                if (priorityPosition) {
                    return players.sort((a, b) => {
                        if (a.position === priorityPosition && b.position !== priorityPosition) return -1;
                        if (a.position !== priorityPosition && b.position === priorityPosition) return 1;
                        return 0;
                    });
                }
                
                return players;
            },
            
            // Game Mode
            startGameMode(trainingIndex = null) {
                if (this.data.players.length === 0) {
                    this.showToast('⚠️ Adicione jogadores primeiro!');
                    return;
                }
                
                if (trainingIndex === null) {
                    // Create new training if none specified
                    this.createTraining();
                    trainingIndex = this.data.trainings.length - 1;
                }
                
                this.data.currentTraining = trainingIndex;
                this.data.gameMode.active = true;
                this.data.gameMode.step = 'initial';
                this.data.gameMode.playData = {};
                this.data.gameMode.history = [];
                this.renderGameMode();
            },
            
            renderGameMode() {
                if (!this.data.gameMode.active) return;
                
                const gameContainer = document.createElement('div');
                gameContainer.className = 'game-mode';
                gameContainer.id = 'gameMode';
                
                let content = '';
                
                // Header
                content += `
                    <div class="game-header">
                        <h2>${this.data.trainings[this.data.currentTraining].name}</h2>
                        <button class="btn btn-icon" onclick="app.exitGameMode()">✕</button>
                    </div>
                    <div class="game-content">
                `;
                
                // Render based on current step
                switch (this.data.gameMode.step) {
                    case 'initial':
                        content += this.renderPlayTypeSelection();
                        break;
                    case 'selectQB':
                        content += this.renderPlayerSelection('QB', 'Selecione quem lançou o passe');
                        break;
                    case 'selectReceiver':
                        content += this.renderPlayerSelection(null, 'Selecione o Recebedor');
                        break;
                    case 'selectRunner':
                        content += this.renderPlayerSelection(null, 'Selecione quem correu');
                        break;
                    case 'selectDefender':
                        const isDefensivePlay = ['sack', 'interception', 'deflection'].includes(this.data.gameMode.playType);
                        content += this.renderPlayerSelection(isDefensivePlay ? 'DEF' : null, 'Selecione o Defensor');
                        break;
                    case 'selectFlagPullDefender':
                        content += this.renderPlayerSelection('DEF', 'Quem fez o Flag Pull?');
                        break;
                    case 'enterYards':
                        content += this.renderYardInput();
                        break;
                    case 'scoringPlay':
                        content += this.renderScoringOption();
                        break;
                    case 'flagPull':
                        content += this.renderFlagPullOption();
                        break;
                    case 'defensiveTD':
                        content += this.renderDefensiveTDOption();
                        break;
                    case 'confirm':
                        content += this.renderPlayConfirmation();
                        break;
                }
                
                content += '</div>';
                
                // Footer with back button
                if (this.data.gameMode.step !== 'initial') {
                    content += `
                        <div class="game-footer">
                            <button class="btn btn-outline" onclick="app.goBack()">
                                ← Voltar
                            </button>
                        </div>
                    `;
                }
                
                gameContainer.innerHTML = content;
                
                document.body.appendChild(gameContainer);
            },
            
            renderPlayTypeSelection() {
                return `
                    <h3 class="mb-3">Selecione o tipo de jogada:</h3>
                    <button class="play-type-btn" onclick="app.selectPlayType('completePass')">
                        <div class="play-type-icon">✓</div>
                        <span>Passe Completo</span>
                    </button>
                    <button class="play-type-btn" onclick="app.selectPlayType('incompletePass')">
                        <div class="play-type-icon">✗</div>
                        <span>Passe Incompleto</span>
                    </button>
                    <button class="play-type-btn" onclick="app.selectPlayType('run')">
                        <div class="play-type-icon">🏃</div>
                        <span>Corrida</span>
                    </button>
                    <button class="play-type-btn" onclick="app.selectPlayType('sack')">
                        <div class="play-type-icon">💥</div>
                        <span>Sack</span>
                    </button>
                    <button class="play-type-btn" onclick="app.selectPlayType('interception')">
                        <div class="play-type-icon">🔄</div>
                        <span>Interceptação</span>
                    </button>
                    <button class="play-type-btn" onclick="app.selectPlayType('deflection')">
                        <div class="play-type-icon">🤚</div>
                        <span>Passe Defletado</span>
                    </button>
                `;
            },
            
            renderPlayerSelection(priorityPosition, title) {
                const players = this.getSortedPlayers(priorityPosition);
                let html = `<h3 class="mb-3">${title}:</h3><ul class="player-list">`;
                
                // Se temos uma posição prioritária, vamos dividir a lista
                if (priorityPosition) {
                    const priorityPlayers = players.filter(p => p.position === priorityPosition);
                    const otherPlayers = players.filter(p => p.position !== priorityPosition);
                    
                    // Renderizar jogadores prioritários primeiro
                    priorityPlayers.forEach(player => {
                        html += `
                            <li class="player-item priority" onclick="app.selectPlayer('${player.id}')">
                                <div class="player-avatar">${player.name.charAt(0).toUpperCase()}</div>
                                <div class="player-info">
                                    <div class="player-name">${player.name}</div>
                                    <div class="player-details">
                                        <span class="position-badge position-${player.position.toLowerCase()}">${player.position}</span>
                                        #${player.number}
                                    </div>
                                </div>
                            </li>
                        `;
                    });
                    
                    // Adicionar divisor se houver outros jogadores
                    if (otherPlayers.length > 0 && priorityPlayers.length > 0) {
                        html += '</ul><div class="section-divider">Outros Jogadores</div><ul class="player-list">';
                    }
                    
                    // Renderizar outros jogadores
                    otherPlayers.forEach(player => {
                        html += `
                            <li class="player-item" onclick="app.selectPlayer('${player.id}')">
                                <div class="player-avatar">${player.name.charAt(0).toUpperCase()}</div>
                                <div class="player-info">
                                    <div class="player-name">${player.name}</div>
                                    <div class="player-details">
                                        <span class="position-badge position-${player.position.toLowerCase()}">${player.position}</span>
                                        #${player.number}
                                    </div>
                                </div>
                            </li>
                        `;
                    });
                } else {
                    // Renderizar todos os jogadores sem distinção
                    players.forEach(player => {
                        html += `
                            <li class="player-item" onclick="app.selectPlayer('${player.id}')">
                                <div class="player-avatar">${player.name.charAt(0).toUpperCase()}</div>
                                <div class="player-info">
                                    <div class="player-name">${player.name}</div>
                                    <div class="player-details">
                                        <span class="position-badge position-${player.position.toLowerCase()}">${player.position}</span>
                                        #${player.number}
                                    </div>
                                </div>
                            </li>
                        `;
                    });
                }
                
                html += '</ul>';
                return html;
            },
            
            renderYardInput() {
                return `
                    <h3 class="mb-3">Quantas jardas?</h3>
                    <div class="form-group">
                        <input type="number" class="form-input" id="yardInput" placeholder="0" autofocus>
                    </div>
                    <button class="btn btn-primary" onclick="app.submitYards()">
                        Continuar
                    </button>
                `;
            },
            
            renderScoringOption() {
                return `
                    <h3 class="mb-3">Resultado da jogada:</h3>
                    <div class="mt-3">
                        <button class="option-btn primary mb-2" onclick="app.setScoring('touchdown')">
                            🏈 TOUCHDOWN!
                        </button>
                        <button class="option-btn secondary mb-2" onclick="app.setScoring('conv1pt')">
                            ☝️ Conversão de 1 ponto
                        </button>
                        <button class="option-btn warning mb-2" onclick="app.setScoring('conv2pt')">
                            ✌️ Conversão de 2 pontos
                        </button>
                        <button class="option-btn" onclick="app.setScoring('none')">
                            ❌ Nenhum (parado/saiu)
                        </button>
                    </div>
                `;
            },
            
            renderFlagPullOption() {
                return `
                    <h3 class="mb-3">Houve flag pull na jogada?</h3>
                    <div class="mt-3">
                        <button class="option-btn primary mb-2" onclick="app.setFlagPull(true)">
                            🚩 Sim
                        </button>
                        <button class="option-btn" onclick="app.setFlagPull(false)">
                            Não
                        </button>
                    </div>
                `;
            },
            
            renderDefensiveTDOption() {
                return `
                    <h3 class="mb-3">Foi touchdown defensivo?</h3>
                    <div class="mt-3">
                        <button class="option-btn primary mb-2" onclick="app.setDefensiveTD(true)">
                            🏈 Sim, TD DEFENSIVO!
                        </button>
                        <button class="option-btn" onclick="app.setDefensiveTD(false)">
                            Não
                        </button>
                    </div>
                `;
            },
            
            renderPlayConfirmation() {
                const play = this.data.gameMode.playData;
                let description = '';
                
                switch (this.data.gameMode.playType) {
                    case 'completePass':
                        description = `${play.qb.name} completa passe de ${play.yards} jardas para ${play.receiver.name}`;
                        if (play.scoring === 'touchdown') description += ' - TOUCHDOWN!';
                        if (play.scoring === 'conv1pt') description += ' - Conversão de 1 ponto';
                        if (play.scoring === 'conv2pt') description += ' - Conversão de 2 pontos';
                        if (play.flagPullDefender) description += ` | Flag pull: ${play.flagPullDefender.name}`;
                        break;
                    case 'incompletePass':
                        description = `${play.qb.name} erra o passe`;
                        break;
                    case 'run':
                        description = `${play.runner.name} corre por ${play.yards} jardas`;
                        if (play.scoring === 'touchdown') description += ' - TOUCHDOWN!';
                        if (play.scoring === 'conv1pt') description += ' - Conversão de 1 ponto';
                        if (play.scoring === 'conv2pt') description += ' - Conversão de 2 pontos';
                        if (play.flagPullDefender) description += ` | Flag pull: ${play.flagPullDefender.name}`;
                        break;
                    case 'sack':
                        description = `${play.defender.name} faz sack em ${play.qb.name}`;
                        break;
                    case 'interception':
                        description = `${play.defender.name} intercepta passe de ${play.qb.name}`;
                        if (play.defensiveTD) description += ' - TD DEFENSIVO!';
                        break;
                    case 'deflection':
                        description = `${play.defender.name} defleta passe de ${play.qb.name}`;
                        break;
                }
                
                return `
                    <h3 class="mb-3">Confirmar jogada:</h3>
                    <div class="card mb-3">
                        <p>${description}</p>
                    </div>
                    <button class="btn btn-primary mb-2" style="width: 100%" onclick="app.confirmPlay()">
                        ✓ Confirmar
                    </button>
                    <button class="btn btn-outline" style="width: 100%" onclick="app.cancelPlay()">
                        ✗ Cancelar
                    </button>
                `;
            },
            
            goBack() {
                const history = this.data.gameMode.history;
                if (history.length > 0) {
                    const previousStep = history.pop();
                    this.data.gameMode.step = previousStep;
                    this.updateGameMode();
                }
            },
            
            selectPlayType(type) {
                this.data.gameMode.playType = type;
                this.data.gameMode.playData = {};
                this.data.gameMode.history = [];
                
                // Determine next step based on play type
                switch (type) {
                    case 'completePass':
                    case 'incompletePass':
                    case 'sack':
                    case 'deflection':
                        this.data.gameMode.step = 'selectQB';
                        break;
                    case 'run':
                        this.data.gameMode.step = 'selectRunner';
                        break;
                    case 'interception':
                        this.data.gameMode.step = 'selectQB';
                        break;
                }
                
                this.updateGameMode();
            },
            
            selectPlayer(playerId) {
                const player = this.data.players.find(p => p.id === playerId);
                const step = this.data.gameMode.step;
                
                // Save current step to history
                this.data.gameMode.history.push(step);
                
                if (step === 'selectQB') {
                    this.data.gameMode.playData.qb = player;
                    
                    switch (this.data.gameMode.playType) {
                        case 'completePass':
                            this.data.gameMode.step = 'selectReceiver';
                            break;
                        case 'incompletePass':
                            this.data.gameMode.step = 'confirm';
                            break;
                        case 'deflection':
                            this.data.gameMode.step = 'selectDefender';
                            break;
                        case 'sack':
                        case 'interception':
                            this.data.gameMode.step = 'selectDefender';
                            break;
                    }
                } else if (step === 'selectReceiver') {
                    this.data.gameMode.playData.receiver = player;
                    this.data.gameMode.step = 'enterYards';
                } else if (step === 'selectRunner') {
                    this.data.gameMode.playData.runner = player;
                    this.data.gameMode.step = 'enterYards';
                } else if (step === 'selectDefender') {
                    this.data.gameMode.playData.defender = player;
                    if (this.data.gameMode.playType === 'interception') {
                        this.data.gameMode.step = 'defensiveTD';
                    } else {
                        this.data.gameMode.step = 'confirm';
                    }
                } else if (step === 'selectFlagPullDefender') {
                    this.data.gameMode.playData.flagPullDefender = player;
                    this.data.gameMode.step = 'confirm';
                }
                
                this.updateGameMode();
            },
            
            submitYards() {
                const yards = parseInt(document.getElementById('yardInput').value) || 0;
                this.data.gameMode.playData.yards = yards;
                
                // Save current step to history
                this.data.gameMode.history.push(this.data.gameMode.step);
                
                if (this.data.gameMode.playType === 'completePass' || this.data.gameMode.playType === 'run') {
                    this.data.gameMode.step = 'scoringPlay';
                } else {
                    this.data.gameMode.step = 'confirm';
                }
                
                this.updateGameMode();
            },
            
            setScoring(type) {
                this.data.gameMode.playData.scoring = type;
                
                // Save current step to history
                this.data.gameMode.history.push(this.data.gameMode.step);
                
                // Se foi TD ou conversão, não teve flag pull
                if (type === 'touchdown' || type === 'conv1pt' || type === 'conv2pt') {
                    this.data.gameMode.step = 'confirm';
                } else {
                    this.data.gameMode.step = 'flagPull';
                }
                
                this.updateGameMode();
            },
            
            setFlagPull(value) {
                // Save current step to history
                this.data.gameMode.history.push(this.data.gameMode.step);
                
                if (value) {
                    this.data.gameMode.step = 'selectFlagPullDefender';
                } else {
                    this.data.gameMode.step = 'confirm';
                }
                
                this.updateGameMode();
            },
            
            setDefensiveTD(value) {
                this.data.gameMode.playData.defensiveTD = value;
                
                // Save current step to history
                this.data.gameMode.history.push(this.data.gameMode.step);
                
                this.data.gameMode.step = 'confirm';
                this.updateGameMode();
            },
            
            confirmPlay() {
                const training = this.data.trainings[this.data.currentTraining];
                const play = {
                    type: this.data.gameMode.playType,
                    data: this.data.gameMode.playData,
                    timestamp: new Date().toISOString()
                };
                
                // Add play to training
                training.plays.push(play);
                
                // Update stats
                this.updateStats(training, play);
                
                // Save and reset
                this.saveData();
                this.data.gameMode.step = 'initial';
                this.data.gameMode.playData = {};
                this.data.gameMode.history = [];
                this.updateGameMode();
                
                this.showToast('✅ Jogada registrada!');
            },
            
            updateStats(training, play) {
                if (!training.stats) training.stats = {};
                
                switch (play.type) {
                    case 'completePass':
                        // QB stats
                        if (!training.stats[play.data.qb.id]) training.stats[play.data.qb.id] = {};
                        training.stats[play.data.qb.id].completions = (training.stats[play.data.qb.id].completions || 0) + 1;
                        training.stats[play.data.qb.id].attempts = (training.stats[play.data.qb.id].attempts || 0) + 1;
                        training.stats[play.data.qb.id].passingYards = (training.stats[play.data.qb.id].passingYards || 0) + play.data.yards;
                        
                        if (play.data.scoring === 'touchdown') {
                            training.stats[play.data.qb.id].touchdowns = (training.stats[play.data.qb.id].touchdowns || 0) + 1;
                        } else if (play.data.scoring === 'conv1pt') {
                            training.stats[play.data.qb.id].conv1pt = (training.stats[play.data.qb.id].conv1pt || 0) + 1;
                        } else if (play.data.scoring === 'conv2pt') {
                            training.stats[play.data.qb.id].conv2pt = (training.stats[play.data.qb.id].conv2pt || 0) + 1;
                        }
                        
                        // Receiver stats
                        if (!training.stats[play.data.receiver.id]) training.stats[play.data.receiver.id] = {};
                        training.stats[play.data.receiver.id].receptions = (training.stats[play.data.receiver.id].receptions || 0) + 1;
                        training.stats[play.data.receiver.id].targets = (training.stats[play.data.receiver.id].targets || 0) + 1;
                        training.stats[play.data.receiver.id].receivingYards = (training.stats[play.data.receiver.id].receivingYards || 0) + play.data.yards;
                        
                        if (play.data.scoring === 'touchdown') {
                            training.stats[play.data.receiver.id].touchdowns = (training.stats[play.data.receiver.id].touchdowns || 0) + 1;
                        } else if (play.data.scoring === 'conv1pt') {
                            training.stats[play.data.receiver.id].conv1pt = (training.stats[play.data.receiver.id].conv1pt || 0) + 1;
                        } else if (play.data.scoring === 'conv2pt') {
                            training.stats[play.data.receiver.id].conv2pt = (training.stats[play.data.receiver.id].conv2pt || 0) + 1;
                        }
                        
                        // Flag pull stats
                        if (play.data.flagPullDefender) {
                            if (!training.stats[play.data.flagPullDefender.id]) training.stats[play.data.flagPullDefender.id] = {};
                            training.stats[play.data.flagPullDefender.id].flagPulls = (training.stats[play.data.flagPullDefender.id].flagPulls || 0) + 1;
                        }
                        break;
                        
                    case 'incompletePass':
                        // QB stats
                        if (!training.stats[play.data.qb.id]) training.stats[play.data.qb.id] = {};
                        training.stats[play.data.qb.id].attempts = (training.stats[play.data.qb.id].attempts || 0) + 1;
                        break;
                        
                    case 'run':
                        // Runner stats
                        if (!training.stats[play.data.runner.id]) training.stats[play.data.runner.id] = {};
                        training.stats[play.data.runner.id].rushAttempts = (training.stats[play.data.runner.id].rushAttempts || 0) + 1;
                        training.stats[play.data.runner.id].rushingYards = (training.stats[play.data.runner.id].rushingYards || 0) + play.data.yards;
                        
                        if (play.data.scoring === 'touchdown') {
                            training.stats[play.data.runner.id].touchdowns = (training.stats[play.data.runner.id].touchdowns || 0) + 1;
                        } else if (play.data.scoring === 'conv1pt') {
                            training.stats[play.data.runner.id].conv1pt = (training.stats[play.data.runner.id].conv1pt || 0) + 1;
                        } else if (play.data.scoring === 'conv2pt') {
                            training.stats[play.data.runner.id].conv2pt = (training.stats[play.data.runner.id].conv2pt || 0) + 1;
                        }
                        
                        // Flag pull stats
                        if (play.data.flagPullDefender) {
                            if (!training.stats[play.data.flagPullDefender.id]) training.stats[play.data.flagPullDefender.id] = {};
                            training.stats[play.data.flagPullDefender.id].flagPulls = (training.stats[play.data.flagPullDefender.id].flagPulls || 0) + 1;
                        }
                        break;
                        
                    case 'sack':
                        // Defender stats
                        if (!training.stats[play.data.defender.id]) training.stats[play.data.defender.id] = {};
                        training.stats[play.data.defender.id].sacks = (training.stats[play.data.defender.id].sacks || 0) + 1;
                        break;
                        
                    case 'interception':
                        // QB stats
                        if (!training.stats[play.data.qb.id]) training.stats[play.data.qb.id] = {};
                        training.stats[play.data.qb.id].interceptions = (training.stats[play.data.qb.id].interceptions || 0) + 1;
                        training.stats[play.data.qb.id].attempts = (training.stats[play.data.qb.id].attempts || 0) + 1;
                        
                        // Defender stats
                        if (!training.stats[play.data.defender.id]) training.stats[play.data.defender.id] = {};
                        training.stats[play.data.defender.id].interceptions = (training.stats[play.data.defender.id].interceptions || 0) + 1;
                        
                        // TD defensivo
                        if (play.data.defensiveTD) {
                            training.stats[play.data.defender.id].touchdowns = (training.stats[play.data.defender.id].touchdowns || 0) + 1;
                        }
                        break;
                        
                    case 'deflection':
                        // QB stats
                        if (!training.stats[play.data.qb.id]) training.stats[play.data.qb.id] = {};
                        training.stats[play.data.qb.id].attempts = (training.stats[play.data.qb.id].attempts || 0) + 1;
                        
                        // Defender stats
                        if (!training.stats[play.data.defender.id]) training.stats[play.data.defender.id] = {};
                        training.stats[play.data.defender.id].deflections = (training.stats[play.data.defender.id].deflections || 0) + 1;
                        break;
                }
            },
            
            cancelPlay() {
                this.data.gameMode.step = 'initial';
                this.data.gameMode.playData = {};
                this.data.gameMode.history = [];
                this.updateGameMode();
            },
            
            updateGameMode() {
                const existingMode = document.getElementById('gameMode');
                if (existingMode) {
                    existingMode.remove();
                }
                this.renderGameMode();
            },
            
            exitGameMode() {
                this.data.gameMode.active = false;
                const gameMode = document.getElementById('gameMode');
                if (gameMode) {
                    gameMode.remove();
                }
            },
            
            // Export/Import
            showExportModal() {
                document.getElementById('exportModal').classList.add('active');
            },
            
            closeExportModal() {
                document.getElementById('exportModal').classList.remove('active');
            },
            
            exportJSON() {
                const data = {
                    version: '1.0',
                    exported: new Date().toISOString(),
                    players: this.data.players,
                    trainings: this.data.trainings
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `gama-flag-football-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showToast('✅ Arquivo exportado!');
            },
            
            exportTrainingJSON(index) {
                const training = this.data.trainings[index];
                const data = {
                    version: '1.0',
                    exported: new Date().toISOString(),
                    training: training,
                    players: this.data.players
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `treino-${training.name.replace(/\s+/g, '-').toLowerCase()}-${new Date(training.date).toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showToast('✅ Treino exportado!');
            },
            
            exportStatsJSON() {
                const playerStats = {};
                
                this.data.players.forEach(player => {
                    playerStats[player.id] = {
                        player: player,
                        totalStats: this.calculatePlayerStats(player.id),
                        trainingBreakdown: []
                    };
                    
                    this.data.trainings.forEach(training => {
                        if (training.stats && training.stats[player.id]) {
                            playerStats[player.id].trainingBreakdown.push({
                                trainingName: training.name,
                                trainingDate: training.date,
                                stats: training.stats[player.id]
                            });
                        }
                    });
                });
                
                const data = {
                    version: '1.0',
                    exported: new Date().toISOString(),
                    totalTrainings: this.data.trainings.length,
                    playerStats: playerStats
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `estatisticas-gerais-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showToast('✅ Estatísticas gerais exportadas!');
            },
            
            copyToClipboard() {
                const data = {
                    version: '1.0',
                    players: this.data.players,
                    trainings: this.data.trainings
                };
                
                const encoded = btoa(JSON.stringify(data));
                const code = `GFF-${encoded}`;
                
                navigator.clipboard.writeText(code).then(() => {
                    this.showToast('📋 Código copiado!');
                });
            },
            
            importJSON(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        this.importData(data);
                    } catch (error) {
                        this.showToast('❌ Erro ao importar arquivo');
                    }
                };
                reader.readAsText(file);
            },
            
            importFromCode() {
                const code = document.getElementById('importCode').value.trim();
                if (!code) return;
                
                try {
                    let data;
                    if (code.startsWith('GFF-')) {
                        const encoded = code.substring(4);
                        data = JSON.parse(atob(encoded));
                    } else {
                        data = JSON.parse(code);
                    }
                    
                    this.importData(data);
                    document.getElementById('importCode').value = '';
                } catch (error) {
                    this.showToast('❌ Código inválido');
                }
            },
            
            importData(data) {
                // Importar jogadores customizados (ID > 22)
                if (data.players) {
                    const customPlayers = data.players.filter(p => parseInt(p.id) > 22);
                    if (customPlayers.length > 0) {
                        // Remover jogadores customizados existentes
                        this.data.players = this.data.players.filter(p => parseInt(p.id) <= 22);
                        // Adicionar novos jogadores customizados
                        this.data.players = [...this.data.players, ...customPlayers];
                    }
                }
                
                // Importar treinos
                if (data.trainings) {
                    this.data.trainings = data.trainings;
                }
                
                // Se for importação de treino individual
                if (data.training && !data.trainings) {
                    // Adicionar o treino importado
                    const existingIndex = this.data.trainings.findIndex(t => t.id === data.training.id);
                    if (existingIndex >= 0) {
                        this.data.trainings[existingIndex] = data.training;
                    } else {
                        this.data.trainings.push(data.training);
                    }
                }
                
                this.saveData();
                this.closeExportModal();
                this.render();
                this.showToast('✅ Dados importados!');
            },
            
            // Utilities
            showToast(message) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            },
            
            attachEventListeners() {
                // Add any global event listeners here
            }
        };
        
        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
</body>
</html>
